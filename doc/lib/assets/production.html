<!DOCTYPE html><html lang="en"><head><title>lib/assets/production</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="lib/assets/production"><meta name="groc-project-path" content="lib/assets/production.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/assets/production.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">"use strict"</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Dependencies. </p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Sets up assets for production.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>options must be an Object.</strong></p>
<ul>
<li><p><strong>options.assetsBaseURI must be a String.</strong><br/>(Assets are served from this URI.)</p>
</li>
<li><p><strong>options.manifest must be an Object.</strong><br/>(A mapping of all assets that can be served.)</p>
</li>
</ul>
</li>
</ul>
<p><strong>Returns a Function</strong></p></div></div><div class="code"><div class="wrapper">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupProductionAssets</span><span class="hljs-params">(options)</span> {</span>
    <span class="hljs-keyword">var</span> manifest = options.manifest;

    <span class="hljs-keyword">var</span> addJavascriptTag = addTagFactory(manifest, options.assetsBaseURI, <span class="hljs-string">'javascripts'</span>, <span class="hljs-string">'script'</span>, <span class="hljs-string">'src'</span>, {
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'text/javascript'</span>,
    }, utils.html.OPENCLOSE);

    <span class="hljs-keyword">var</span> addStylesheetTag = addTagFactory(manifest, options.assetsBaseURI, <span class="hljs-string">'stylesheets'</span>, <span class="hljs-string">'link'</span>, <span class="hljs-string">'href'</span>, {
        <span class="hljs-string">'rel'</span>: <span class="hljs-string">'stylesheet'</span>,
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'text/css'</span>,
    }, utils.html.AUTOCLOSE);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assets</span><span class="hljs-params">(req, res, next)</span> {</span>
        res.locals.add_javascript_tag = addJavascriptTag;
        res.locals.add_stylesheet_link = addStylesheetTag;
        next();
    };

    assets.serveAssets = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
        next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Refusing to serve assets in production mode.'</span>));
    };

    <span class="hljs-keyword">return</span> assets;
};</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Generates a method to create a HTML tag.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>manifest must be an Object.</strong><br/>(An object describing all available assets.)</p>
</li>
<li><p><strong>assetsBaseURI must be a String.</strong><br/>(The path from where static files will be served.)</p>
</li>
<li><p><strong>type must be a String.</strong><br/>(The asset type.)</p>
</li>
<li><p><strong>tag must be a String.</strong><br/>(The HTML tag to use.)</p>
</li>
<li><p><strong>srcAttr must be a String.</strong><br/>(Which attributes to use for the source (e.g. href=&quot;&quot; or src=&quot;&quot;).)</p>
</li>
<li><p><strong>attributes is optional and must be an Object.</strong><br/>(Extra HTML attributes to use.)</p>
</li>
<li><p><strong>opts is optional, must be a Number, and has a default value of 0.</strong><br/>(Which opts to use when generating the HTML.)</p>
</li>
</ul>
<p><strong>Returns a Function</strong></p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTagFactory</span><span class="hljs-params">(manifest, assetsBaseURI, type, tag, srcAttr, attributes, opts)</span> {</span>
    attributes = attributes || {};
    opts = opts || <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Create a HTML tag.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>file must be a String.</strong><br/>(The file to link to.)</p>
</li>
<li><p><strong>options is optional and must be an Object.</strong><br/>(Extra HTML attributes to use.)</p>
</li>
</ul>
<p><strong>Returns a String</strong></p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_tag</span><span class="hljs-params">(file, options)</span> {</span>
        <span class="hljs-keyword">if</span> (utils.defined(manifest[file])) {
            file = manifest[file];
        }

        <span class="hljs-keyword">var</span> attrs = utils.copy(options, attributes);
        attrs[srcAttr] = path.join(assetsBaseURI, <span class="hljs-string">'assets'</span>, file);
        <span class="hljs-keyword">return</span> utils.html(tag, attrs, opts);
    }
}</div></div></div></div></body></html>